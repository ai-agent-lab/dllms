\begin{equation}
\begin{aligned}
\mathcal{L}_{\text{diffu-GRPO}}(\theta) &= \mathbb{E}_{\substack{q \sim \mathcal{D},\, q' \sim \text{masking}(q),\\
              o_1,\dots,o_G \sim \pi_{\theta_{\text{old}}}(\,\cdot \mid q)}}\Bigg[
\frac{1}{G}\sum_{i=1}^{G}\frac{1}{|o_i|}\sum_{k=1}^{|o_i|}\\
&\quad\min\!\Bigg(
      \frac{\phi^{\pi_\theta}(o^k_i \mid q')}
           {\phi^{\pi_{\theta_{\text{old}}}}(o^k_i \mid q')}A_i^{k},\\
&\qquad\operatorname{clip}\!\Bigg(
        \frac{\phi^{\pi_\theta}(o^k_i \mid q')}
             {\phi^{\pi_{\theta_{\text{old}}}}(o^k_i \mid q')},
        1-\varepsilon,\,1+\varepsilon
  \Bigg)A_i^{k}
\Bigg)\\
&\quad-\beta\,D_{\text{KL}}\!\Bigl[
   \phi^{\pi_\theta}(\cdot \mid q')\,\bigl\|\,\phi^{\pi_{\text{ref}}}(\cdot \mid q')
\Bigr]
\Bigg],
\end{aligned}
\label{eq:diffugrpo}
\end{equation}